<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AutoTax — Kayıt Ol</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --brand: #2563eb; --brand-d: #1d4ed8; --brand-l: #dbeafe;
      --surface: #ffffff; --bg: #f1f5f9; --text: #0f172a;
      --muted: #64748b; --border: #e2e8f0; --error: #ef4444;
      --success: #22c55e; --radius: 12px;
    }
    body { min-height: 100vh; display: flex; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); }

    .hero { display: none; flex: 1; background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #0ea5e9 100%);
            padding: 60px 56px; color: #fff; flex-direction: column; justify-content: space-between;
            position: relative; overflow: hidden; }
    @media (min-width: 900px) { .hero { display: flex; } }
    .hero::before { content: ''; position: absolute; width: 600px; height: 600px; border-radius: 50%;
                    background: rgba(255,255,255,.05); top: -200px; right: -200px; }
    .hero-logo { display: flex; align-items: center; gap: 12px; font-size: 24px; font-weight: 700; }
    .hero-logo svg { background: rgba(255,255,255,.2); padding: 8px; border-radius: 10px; }
    .hero-content h1 { font-size: clamp(26px, 3vw, 38px); font-weight: 800; line-height: 1.2; margin-bottom: 20px; }
    .hero-content p { font-size: 15px; opacity: .8; line-height: 1.7; max-width: 380px; }

    /* Plan cards in hero */
    .plan-cards { display: flex; flex-direction: column; gap: 12px; }
    .plan-card { background: rgba(255,255,255,.1); backdrop-filter: blur(10px);
                 border-radius: 12px; padding: 16px 20px; border: 1px solid rgba(255,255,255,.2); }
    .plan-card.featured { background: rgba(255,255,255,.2); border-color: rgba(255,255,255,.5); }
    .plan-card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .plan-card-name { font-weight: 700; font-size: 15px; }
    .plan-card-price { font-size: 20px; font-weight: 800; }
    .plan-card-price span { font-size: 12px; font-weight: 400; opacity: .7; }
    .plan-card-feat { font-size: 12px; opacity: .75; line-height: 1.6; }
    .hot-badge { background: #f59e0b; color: #fff; font-size: 10px; font-weight: 700;
                 padding: 2px 8px; border-radius: 20px; }

    .auth-panel { flex: 0 0 100%; display: flex; align-items: flex-start; justify-content: center;
                  padding: 40px 24px; overflow-y: auto; }
    @media (min-width: 900px) { .auth-panel { flex: 0 0 500px; align-items: center; } }

    .auth-card { width: 100%; max-width: 420px; }
    .logo-mobile { display: flex; align-items: center; gap: 10px; font-size: 22px; font-weight: 800;
                   color: var(--brand); margin-bottom: 32px; }
    @media (min-width: 900px) { .logo-mobile { display: none; } }

    .auth-card h2 { font-size: 26px; font-weight: 800; color: var(--text); margin-bottom: 6px; }
    .auth-card .subtitle { font-size: 14px; color: var(--muted); margin-bottom: 24px; }

    /* Plan selector */
    .plan-selector { display: flex; gap: 8px; margin-bottom: 24px; }
    .plan-opt { flex: 1; border: 2px solid var(--border); border-radius: 10px; padding: 10px 8px;
                text-align: center; cursor: pointer; transition: all .2s; position: relative; }
    .plan-opt:hover { border-color: var(--brand); }
    .plan-opt.selected { border-color: var(--brand); background: #eff6ff; }
    .plan-opt input { display: none; }
    .plan-opt .opt-name { font-size: 13px; font-weight: 700; color: var(--text); }
    .plan-opt .opt-price { font-size: 15px; font-weight: 800; color: var(--brand); }
    .plan-opt .opt-inv { font-size: 11px; color: var(--muted); }
    .plan-opt .pop-tag { position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
                         background: var(--brand); color: #fff; font-size: 10px; font-weight: 700;
                         padding: 2px 8px; border-radius: 20px; white-space: nowrap; }

    .form-row { display: flex; gap: 12px; }
    .form-row .form-group { flex: 1; }
    .form-group { margin-bottom: 14px; }
    label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 5px; }
    .input-wrap { position: relative; }
    .input-wrap svg { position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
                      color: var(--muted); pointer-events: none; }
    input[type=email], input[type=password], input[type=text] {
      width: 100%; height: 46px; border: 1.5px solid var(--border); border-radius: var(--radius);
      padding: 0 44px 0 42px; font-size: 14px; color: var(--text); background: var(--surface);
      transition: border-color .2s, box-shadow .2s; outline: none;
    }
    input:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(37,99,235,.12); }
    input.error-input { border-color: var(--error); }
    .eye-btn { position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
               background: none; border: none; cursor: pointer; color: var(--muted); padding: 4px; }
    .eye-btn:hover { color: var(--brand); }

    /* Password strength */
    .pw-strength { margin-top: 6px; display: flex; gap: 4px; }
    .pw-bar { flex: 1; height: 3px; background: var(--border); border-radius: 2px; transition: background .3s; }
    .pw-bar.weak   { background: var(--error); }
    .pw-bar.fair   { background: #f59e0b; }
    .pw-bar.strong { background: var(--success); }
    .pw-label { font-size: 11px; color: var(--muted); margin-top: 4px; }

    .terms { font-size: 12px; color: var(--muted); margin-bottom: 16px; line-height: 1.6; }
    .terms a { color: var(--brand); text-decoration: none; }
    .terms a:hover { text-decoration: underline; }

    .btn-primary { width: 100%; height: 48px; background: var(--brand); color: #fff;
                   border: none; border-radius: var(--radius); font-size: 15px; font-weight: 700;
                   cursor: pointer; transition: background .2s, transform .1s, opacity .2s;
                   display: flex; align-items: center; justify-content: center; gap: 8px; }
    .btn-primary:hover { background: var(--brand-d); }
    .btn-primary:active { transform: scale(.98); }
    .btn-primary:disabled { opacity: .6; cursor: not-allowed; }

    .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,.4);
               border-top-color: #fff; border-radius: 50%; animation: spin .7s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .auth-switch { text-align: center; margin-top: 16px; font-size: 13px; color: var(--muted); }
    .auth-switch a { color: var(--brand); font-weight: 700; text-decoration: none; }

    .alert { border-radius: 8px; padding: 12px 16px; font-size: 13px; margin-bottom: 14px;
             display: none; align-items: center; gap: 10px; }
    .alert.show { display: flex; }
    .alert-error   { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
    .alert-success { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
  </style>
</head>
<body>

<!-- ═══ SOL HERO ═══════════════════════════════════════════ -->
<section class="hero">
  <div class="hero-logo">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <polyline points="14 2 14 8 20 8"/>
    </svg>
    AutoTax
  </div>

  <div class="hero-content">
    <h1>İşletmeniz için doğru plan</h1>
    <p>Küçük işletmeden kurumsal ölçeğe kadar her ihtiyaç için esnek abonelik seçenekleri.</p>
  </div>

  <div class="plan-cards">
    <div class="plan-card">
      <div class="plan-card-top">
        <div class="plan-card-name">Free</div>
        <div class="plan-card-price">$0 <span>/ay</span></div>
      </div>
      <div class="plan-card-feat">50 fatura/ay · OCR + QR · CSV export</div>
    </div>
    <div class="plan-card featured">
      <div class="plan-card-top">
        <div class="plan-card-name">Pro <span class="hot-badge">En Popüler</span></div>
        <div class="plan-card-price">$29 <span>/ay</span></div>
      </div>
      <div class="plan-card-feat">500 fatura/ay · Öncelikli destek · Excel export · Analitik</div>
    </div>
    <div class="plan-card">
      <div class="plan-card-top">
        <div class="plan-card-name">Enterprise</div>
        <div class="plan-card-price">$99 <span>/ay</span></div>
      </div>
      <div class="plan-card-feat">Sınırsız fatura · API erişimi · SLA garantisi · Özel entegrasyon</div>
    </div>
  </div>
</section>

<!-- ═══ SAĞ KAYIT PANELİ ═══════════════════════════════════ -->
<section class="auth-panel">
  <div class="auth-card">

    <div class="logo-mobile">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
      </svg>
      AutoTax
    </div>

    <h2>Hesap oluşturun</h2>
    <p class="subtitle">Kredi kartı gerekmez · Ücretsiz başlayın</p>

    <div class="alert alert-error" id="alert-error">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <span id="alert-error-msg"></span>
    </div>
    <div class="alert alert-success" id="alert-success">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
      <span id="alert-success-msg"></span>
    </div>

    <!-- Plan seçici -->
    <div class="plan-selector">
      <label class="plan-opt selected" id="opt-free">
        <input type="radio" name="plan" value="free" checked>
        <div class="opt-name">Free</div>
        <div class="opt-price">$0</div>
        <div class="opt-inv">50/ay</div>
      </label>
      <label class="plan-opt" id="opt-pro">
        <div class="pop-tag">Popüler</div>
        <input type="radio" name="plan" value="pro">
        <div class="opt-name">Pro</div>
        <div class="opt-price">$29</div>
        <div class="opt-inv">500/ay</div>
      </label>
      <label class="plan-opt" id="opt-enterprise">
        <input type="radio" name="plan" value="enterprise">
        <div class="opt-name">Enterprise</div>
        <div class="opt-price">$99</div>
        <div class="opt-inv">Sınırsız</div>
      </label>
    </div>

    <form id="register-form" autocomplete="on" novalidate>
      <div class="form-group">
        <label for="full_name">Ad Soyad</label>
        <div class="input-wrap">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          <input type="text" id="full_name" name="full_name" placeholder="Ahmet Yılmaz" autocomplete="name">
        </div>
      </div>

      <div class="form-group">
        <label for="email">E-posta adresi</label>
        <div class="input-wrap">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
            <polyline points="22,6 12,13 2,6"/>
          </svg>
          <input type="email" id="email" name="email" placeholder="ornek@sirket.com" autocomplete="email" required>
        </div>
      </div>

      <div class="form-group">
        <label for="password">Şifre</label>
        <div class="input-wrap">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          <input type="password" id="password" name="password" placeholder="Minimum 8 karakter" autocomplete="new-password" required>
          <button type="button" class="eye-btn" id="toggle-pw">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
          </button>
        </div>
        <div class="pw-strength">
          <div class="pw-bar" id="bar1"></div>
          <div class="pw-bar" id="bar2"></div>
          <div class="pw-bar" id="bar3"></div>
          <div class="pw-bar" id="bar4"></div>
        </div>
        <div class="pw-label" id="pw-label"></div>
      </div>

      <p class="terms">
        Kaydolarak <a href="/privacy.html" target="_blank">Kullanım Şartları</a>'nı ve <a href="/privacy.html" target="_blank">Gizlilik Politikası</a>'nı kabul etmiş olursunuz.
      </p>

      <!-- GDPR Onay Kutusu -->
      <label style="display:flex;align-items:flex-start;gap:10px;margin-bottom:16px;cursor:pointer;font-size:13px;color:#475569;line-height:1.5">
        <input type="checkbox" id="gdpr-consent" required style="margin-top:2px;width:16px;height:16px;flex-shrink:0;accent-color:#2563eb">
        <span>
          Kişisel verilerimin (e-posta, ad, fatura verileri) AutoTax.cloud tarafından
          <a href="/privacy.html" target="_blank" style="color:#2563eb">Gizlilik Politikası</a>'na
          uygun şekilde AB/GDPR kuralları çerçevesinde işlenmesini <strong>onaylıyorum</strong>.
          Verilerimi istediğim zaman silebileceğimi biliyorum.
        </span>
      </label>

      <button type="submit" class="btn-primary" id="reg-btn">
        <span id="btn-text">Hesap Oluştur &amp; Başla</span>
      </button>
    </form>

    <p class="auth-switch">
      Zaten hesabınız var mı? <a href="/login.html">Giriş yapın</a>
    </p>
  </div>
</section>

<script>
const API = '/api';

// Plan seçici
document.querySelectorAll('.plan-opt').forEach(opt => {
  opt.addEventListener('click', function() {
    document.querySelectorAll('.plan-opt').forEach(o => o.classList.remove('selected'));
    this.classList.add('selected');
  });
});

// Şifre göster/gizle
document.getElementById('toggle-pw').addEventListener('click', function() {
  const inp = document.getElementById('password');
  inp.type = inp.type === 'password' ? 'text' : 'password';
});

// Şifre güçü
document.getElementById('password').addEventListener('input', function() {
  const v = this.value;
  const bars = [document.getElementById('bar1'), document.getElementById('bar2'),
                document.getElementById('bar3'), document.getElementById('bar4')];
  const lbl  = document.getElementById('pw-label');
  let score  = 0;
  if (v.length >= 8)  score++;
  if (/[A-Z]/.test(v)) score++;
  if (/[0-9]/.test(v)) score++;
  if (/[^A-Za-z0-9]/.test(v)) score++;
  bars.forEach((b, i) => {
    b.className = 'pw-bar';
    if (i < score) b.classList.add(score <= 1 ? 'weak' : score <= 2 ? 'fair' : 'strong');
  });
  const labels = ['', 'Zayıf', 'Orta', 'İyi', 'Güçlü'];
  lbl.textContent = v.length ? labels[score] : '';
  lbl.style.color = score <= 1 ? '#ef4444' : score <= 2 ? '#f59e0b' : '#22c55e';
});

document.getElementById('register-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const btn     = document.getElementById('reg-btn');
  const btnText = document.getElementById('btn-text');
  const errBox  = document.getElementById('alert-error');
  const errMsg  = document.getElementById('alert-error-msg');
  const okBox   = document.getElementById('alert-success');
  const okMsg   = document.getElementById('alert-success-msg');

  errBox.classList.remove('show');
  okBox.classList.remove('show');
  btn.disabled = true;
  btnText.innerHTML = '<div class="spinner"></div>';

  const plan = document.querySelector('input[name=plan]:checked').value;

  try {
    const res  = await fetch(`${API}/auth/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({
        email:     document.getElementById('email').value.trim(),
        password:  document.getElementById('password').value,
        full_name: document.getElementById('full_name').value.trim(),
      }),
    });
    const data = await res.json();

    if (!res.ok) {
      errMsg.textContent = data.detail || 'Kayıt başarısız.';
      errBox.classList.add('show');
      return;
    }

    localStorage.setItem('at_token', data.access_token);
    localStorage.setItem('at_user',  JSON.stringify(data.user));

    okMsg.textContent = 'Hesabınız oluşturuldu! Yönlendiriliyorsunuz...';
    okBox.classList.add('show');
    setTimeout(() => { window.location.href = '/index.html'; }, 1200);

  } catch (err) {
    errMsg.textContent = 'Sunucuya bağlanılamadı.';
    errBox.classList.add('show');
  } finally {
    btn.disabled = false;
    btnText.textContent = 'Hesap Oluştur & Başla';
  }
});

(function() {
  if (localStorage.getItem('at_token')) window.location.href = '/index.html';
})();
</script>
</body>
</html>
