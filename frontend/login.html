<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AutoTax.cloud — Giriş Yap</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --brand:    #2563eb;
      --brand-d:  #1d4ed8;
      --brand-l:  #dbeafe;
      --surface:  #ffffff;
      --bg:       #f1f5f9;
      --text:     #0f172a;
      --muted:    #64748b;
      --border:   #e2e8f0;
      --error:    #ef4444;
      --success:  #22c55e;
      --radius:   12px;
    }

    body {
      min-height: 100vh;
      display: flex;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
    }

    /* ── Sol panel ── */
    .hero {
      display: none;
      flex: 1;
      background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #0ea5e9 100%);
      padding: 60px 56px;
      color: #fff;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }
    @media (min-width: 900px) { .hero { display: flex; } }

    .hero::before {
      content: '';
      position: absolute;
      width: 600px; height: 600px;
      border-radius: 50%;
      background: rgba(255,255,255,.05);
      top: -200px; right: -200px;
    }
    .hero::after {
      content: '';
      position: absolute;
      width: 400px; height: 400px;
      border-radius: 50%;
      background: rgba(255,255,255,.05);
      bottom: -100px; left: -100px;
    }

    .hero-logo { display: flex; align-items: center; gap: 12px; font-size: 24px; font-weight: 700; }
    .hero-logo svg { background: rgba(255,255,255,.2); padding: 8px; border-radius: 10px; }

    .hero-content { position: relative; z-index: 1; }
    .hero-content h1 { font-size: clamp(28px, 3vw, 40px); font-weight: 800; line-height: 1.2; margin-bottom: 20px; }
    .hero-content p  { font-size: 16px; opacity: .8; line-height: 1.7; max-width: 380px; }

    .hero-features { position: relative; z-index: 1; display: flex; flex-direction: column; gap: 16px; }
    .feat { display: flex; align-items: center; gap: 14px; }
    .feat-icon { width: 40px; height: 40px; background: rgba(255,255,255,.15); border-radius: 10px;
                 display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .feat-text strong { display: block; font-size: 14px; font-weight: 600; }
    .feat-text span   { font-size: 13px; opacity: .7; }

    /* ── Sağ panel ── */
    .auth-panel {
      flex: 0 0 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 24px;
    }
    @media (min-width: 900px) { .auth-panel { flex: 0 0 480px; } }

    .auth-card {
      width: 100%;
      max-width: 400px;
    }

    .auth-card .logo-mobile {
      display: flex; align-items: center; gap: 10px;
      font-size: 22px; font-weight: 800; color: var(--brand);
      margin-bottom: 32px;
    }
    @media (min-width: 900px) { .auth-card .logo-mobile { display: none; } }

    .auth-card h2 { font-size: 26px; font-weight: 800; color: var(--text); margin-bottom: 6px; }
    .auth-card .subtitle { font-size: 14px; color: var(--muted); margin-bottom: 32px; }

    /* Social login */
    .social-btns { display: flex; gap: 10px; margin-bottom: 20px; }
    .btn-social {
      flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px;
      height: 44px; border: 1.5px solid var(--border); border-radius: var(--radius);
      font-size: 13px; font-weight: 600; color: var(--text);
      background: var(--surface); cursor: pointer; transition: border-color .2s, background .2s;
      text-decoration: none;
    }
    .btn-social:hover { border-color: var(--brand); background: var(--brand-l); }

    .divider { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; color: var(--muted); font-size: 12px; }
    .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    /* Form */
    .form-group { margin-bottom: 16px; }
    label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 6px; }

    .input-wrap { position: relative; }
    .input-wrap svg { position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
                      color: var(--muted); pointer-events: none; }

    input[type=email], input[type=password], input[type=text] {
      width: 100%; height: 46px;
      border: 1.5px solid var(--border); border-radius: var(--radius);
      padding: 0 44px 0 42px;
      font-size: 14px; color: var(--text); background: var(--surface);
      transition: border-color .2s, box-shadow .2s;
      outline: none;
    }
    input:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(37,99,235,.12); }
    input.error-input { border-color: var(--error); }

    .eye-btn {
      position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
      background: none; border: none; cursor: pointer; color: var(--muted); padding: 4px;
    }
    .eye-btn:hover { color: var(--brand); }

    .form-footer { display: flex; justify-content: space-between; align-items: center;
                   font-size: 13px; margin-bottom: 20px; }
    .remember { display: flex; align-items: center; gap: 6px; cursor: pointer; }
    .remember input[type=checkbox] { width: 15px; height: 15px; accent-color: var(--brand); }
    .forgot { color: var(--brand); text-decoration: none; font-weight: 600; }
    .forgot:hover { text-decoration: underline; }

    .btn-primary {
      width: 100%; height: 48px;
      background: var(--brand); color: #fff;
      border: none; border-radius: var(--radius);
      font-size: 15px; font-weight: 700; cursor: pointer;
      transition: background .2s, transform .1s, opacity .2s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-primary:hover  { background: var(--brand-d); }
    .btn-primary:active { transform: scale(.98); }
    .btn-primary:disabled { opacity: .6; cursor: not-allowed; }

    .spinner {
      width: 18px; height: 18px; border: 2px solid rgba(255,255,255,.4);
      border-top-color: #fff; border-radius: 50%; animation: spin .7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .auth-switch { text-align: center; margin-top: 20px; font-size: 13px; color: var(--muted); }
    .auth-switch a { color: var(--brand); font-weight: 700; text-decoration: none; }
    .auth-switch a:hover { text-decoration: underline; }

    /* Alert */
    .alert {
      border-radius: 8px; padding: 12px 16px; font-size: 13px; margin-bottom: 16px;
      display: none; align-items: center; gap: 10px;
    }
    .alert.show { display: flex; }
    .alert-error   { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
    .alert-success { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }

    /* Plan badges */
    .plans-mini { display: flex; gap: 8px; margin-bottom: 28px; }
    .plan-badge {
      flex: 1; text-align: center; border: 1.5px solid var(--border);
      border-radius: 10px; padding: 10px 6px; cursor: default; transition: border-color .2s;
    }
    .plan-badge.popular { border-color: var(--brand); background: #eff6ff; }
    .plan-badge .plan-name { font-size: 12px; font-weight: 700; color: var(--text); }
    .plan-badge .plan-price { font-size: 16px; font-weight: 800; color: var(--brand); }
    .plan-badge .plan-label { font-size: 11px; color: var(--muted); }
    .plan-badge .badge-hot { font-size: 10px; font-weight: 700; color: #fff;
                              background: var(--brand); border-radius: 4px; padding: 1px 5px; display: inline-block; margin-bottom: 4px; }
  </style>
</head>
<body>

<!-- ═══ SOL HERO ═══════════════════════════════════════════ -->
<section class="hero">
  <div class="hero-logo">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <polyline points="14 2 14 8 20 8"/>
      <line x1="16" y1="13" x2="8" y2="13"/>
      <line x1="16" y1="17" x2="8" y2="17"/>
    </svg>
    AutoTax<b>.cloud</b>
  </div>

  <div class="hero-content">
    <h1>Dünya genelinde fatura yönetiminin en akıllı yolu</h1>
    <p>OCR, QR okuma, çok dilli destek ve gerçek zamanlı analitik — tümü tek platformda.</p>
  </div>

  <div class="hero-features">
    <div class="feat">
      <div class="feat-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
      </div>
      <div class="feat-text">
        <strong>8 Dil OCR Desteği</strong>
        <span>Türkçe, Almanca, Arapça, Çince ve daha fazlası</span>
      </div>
    </div>
    <div class="feat">
      <div class="feat-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
          <rect x="3" y="3" width="5" height="5"/><rect x="16" y="3" width="5" height="5"/>
          <rect x="3" y="16" width="5" height="5"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/>
          <path d="M16 21v-3a2 2 0 0 0-2-2h-1"/>
        </svg>
      </div>
      <div class="feat-text">
        <strong>QR Kod Okuma</strong>
        <span>Fatura verilerini anında doğrula</span>
      </div>
    </div>
    <div class="feat">
      <div class="feat-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
          <line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/>
          <line x1="6" y1="20" x2="6" y2="14"/>
        </svg>
      </div>
      <div class="feat-text">
        <strong>Gerçek Zamanlı Analitik</strong>
        <span>KDV, kategori ve firma bazlı raporlar</span>
      </div>
    </div>
    <div class="feat">
      <div class="feat-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
      </div>
      <div class="feat-text">
        <strong>Excel &amp; CSV Export</strong>
        <span>100 milyon faturaya kadar sınırsız</span>
      </div>
    </div>
  </div>
</section>

<!-- ═══ SAĞ AUTH PANELİ ════════════════════════════════════ -->
<section class="auth-panel">
  <div class="auth-card">

    <div class="logo-mobile">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
      </svg>
      AutoTax<b>.cloud</b>
    </div>

    <h2>Tekrar hoş geldiniz</h2>
    <p class="subtitle">Hesabınıza giriş yapın veya <a href="/register.html" style="color:var(--brand);font-weight:600;">ücretsiz başlayın</a></p>

    <!-- Alert -->
    <div class="alert alert-error" id="alert-error">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <span id="alert-error-msg"></span>
    </div>

    <!-- Form -->
    <form id="login-form" autocomplete="on" novalidate>
      <div class="form-group">
        <label for="email">E-posta adresi</label>
        <div class="input-wrap">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
            <polyline points="22,6 12,13 2,6"/>
          </svg>
          <input type="email" id="email" name="email" placeholder="ornek@sirket.com" autocomplete="email" required>
        </div>
      </div>

      <div class="form-group">
        <label for="password">Şifre</label>
        <div class="input-wrap">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          <input type="password" id="password" name="password" placeholder="••••••••" autocomplete="current-password" required>
          <button type="button" class="eye-btn" id="toggle-pw" aria-label="Şifreyi göster">
            <svg id="eye-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="form-footer">
        <label class="remember">
          <input type="checkbox" id="remember"> Beni hatırla
        </label>
        <a href="#" class="forgot" id="forgotLink">Şifremi unuttum</a>
      </div>

      <button type="submit" class="btn-primary" id="login-btn">
        <span id="btn-text">Giriş Yap</span>
      </button>
    </form>

    <p class="auth-switch">
      Hesabınız yok mu? <a href="/register.html">Ücretsiz kayıt ol</a>
    </p>
  </div>
</section>

<!-- Şifremi Unuttum Modal -->
<div id="forgotModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;align-items:center;justify-content:center;padding:20px">
  <div style="background:#fff;border-radius:16px;padding:32px;width:100%;max-width:420px;box-shadow:0 20px 60px rgba(0,0,0,.3);position:relative">
    <button id="forgotClose" type="button" style="position:absolute;top:16px;right:16px;background:none;border:none;font-size:20px;cursor:pointer;color:#64748b">✕</button>
    <h3 style="font-size:20px;font-weight:700;color:#0f172a;margin-bottom:8px">Şifremi Unuttum</h3>
    <p style="color:#64748b;font-size:14px;margin-bottom:20px">E-posta adresinizi girin, şifre sıfırlama bağlantısı gönderelim.</p>
    <form id="forgotForm">
      <label style="display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:6px">E-posta Adresi</label>
      <input id="forgotEmail" type="email" required placeholder="ornek@mail.com"
        style="width:100%;padding:11px 14px;border:1.5px solid #e2e8f0;border-radius:10px;font-size:14px;outline:none;margin-bottom:14px">
      <button id="forgotBtn" type="submit"
        style="width:100%;padding:12px;background:#2563eb;color:#fff;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer">
        Sıfırlama Bağlantısı Gönder
      </button>
      <p id="forgotMsg" style="display:none;margin-top:12px;font-size:13px;text-align:center"></p>
    </form>
  </div>
</div>

<script>
const API = '/api';

document.getElementById('toggle-pw').addEventListener('click', function() {
  const inp  = document.getElementById('password');
  const icon = document.getElementById('eye-icon');
  const show = inp.type === 'password';
  inp.type   = show ? 'text' : 'password';
  this.title = show ? 'Şifreyi gizle' : 'Şifreyi göster';
  // Göz açık = şifre görünüyor | Göz kapalı = şifre gizli
  icon.innerHTML = show
    ? `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>`
    : `<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>`;
});

document.getElementById('login-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const btn     = document.getElementById('login-btn');
  const btnText = document.getElementById('btn-text');
  const errBox  = document.getElementById('alert-error');
  const errMsg  = document.getElementById('alert-error-msg');

  errBox.classList.remove('show');
  btn.disabled = true;
  btnText.innerHTML = '<div class="spinner"></div>';

  const email    = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  try {
    const res  = await fetch(`${API}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ email, password }),
    });
    const data = await res.json();

    if (!res.ok) {
      errMsg.textContent = data.detail || 'Giriş başarısız.';
      errBox.classList.add('show');
      return;
    }

    localStorage.setItem('at_token', data.access_token);
    localStorage.setItem('at_user',  JSON.stringify(data.user));
    window.location.href = '/index.html';

  } catch (err) {
    errMsg.textContent = 'Sunucuya bağlanılamadı. Lütfen tekrar deneyin.';
    errBox.classList.add('show');
  } finally {
    btn.disabled = false;
    btnText.textContent = 'Giriş Yap';
  }
});

// Zaten giriş yapılmışsa dashboard'a yönlendir
(function() {
  const tok = localStorage.getItem('at_token');
  if (tok) window.location.href = '/index.html';
})();

// ── Şifremi Unuttum Modal ─────────────────────────────────
document.getElementById('forgotLink').addEventListener('click', function(e) {
  e.preventDefault();
  document.getElementById('forgotModal').style.display = 'flex';
  document.getElementById('forgotEmail').value = document.getElementById('email').value || '';
  document.getElementById('forgotEmail').focus();
});

document.getElementById('forgotClose').addEventListener('click', function() {
  document.getElementById('forgotModal').style.display = 'none';
});

document.getElementById('forgotForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const btn = document.getElementById('forgotBtn');
  const msg = document.getElementById('forgotMsg');
  const email = document.getElementById('forgotEmail').value.trim();
  btn.disabled = true;
  btn.textContent = 'Gönderiliyor...';
  msg.style.display = 'none';
  try {
    const res = await fetch(`${API}/auth/forgot-password`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });
    const data = await res.json();
    msg.style.display = 'block';
    msg.style.color = res.ok ? '#22c55e' : '#ef4444';
    msg.textContent = data.message || 'E-posta gönderildi.';
    if (res.ok) btn.textContent = '✓ Gönderildi';
  } catch {
    msg.style.display = 'block';
    msg.style.color = '#ef4444';
    msg.textContent = 'Bağlantı hatası. Lütfen tekrar deneyin.';
    btn.disabled = false;
    btn.textContent = 'Bağlantı Gönder';
  }
});
</script>
</body>
</html>
